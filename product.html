<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Product details - Wasam.store">
    <title>Product Details | Wasam.store</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="assets/logo.png">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-main">
            <a href="index.html" class="logo">
                <img src="assets/logo.png" alt="Wasam.store">
                <div class="logo-text">
                    <span class="logo-name">Wasam.store</span>
                    <span class="logo-tagline">Honest Finds</span>
                </div>
            </a>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search products..." autocomplete="off">
                    <button type="button" id="searchBtn" aria-label="Search">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="header-actions desktop-only">
                <button class="globe-btn" id="globeBtn" aria-label="Select Country">
                    <span id="currentCountryDisplay">ðŸŒŽ</span>
                    <div class="country-dropdown" id="countryDropdown"></div>
                </button>
                <a href="contact.html" class="btn btn-primary"><span>Join Our Team</span></a>
                <a href="login.html" class="btn btn-outline"><span>Login</span></a>
            </div>

            <!-- Mobile Menu Button (Right Corner) -->
            <button class="mobile-menu-btn" aria-label="Toggle Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-container">
                <!-- Mobile Actions (Inside Menu) -->
                <div class="mobile-nav-actions mobile-only">
                    <div
                        style="display: flex; gap: 10px; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 20px;">
                        <button class="globe-btn" id="mobileGlobeBtn" aria-label="Select Country">
                            <span id="mobileCurrentCountryDisplay">ðŸŒŽ</span>
                            <div class="country-dropdown" id="mobileCountryDropdown"></div>
                        </button>
                        <div style="display: flex; gap: 10px;">
                            <a href="login.html" class="btn btn-outline" style="padding: 8px 12px; font-size: 14px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                                    <polyline points="10 17 15 12 10 7" />
                                    <line x1="15" y1="12" x2="3" y2="12" />
                                </svg>
                            </a>
                        </div>
                    </div>
                    <a href="contact.html" class="btn btn-primary"
                        style="width: 100%; justify-content: center; margin-bottom: 20px;">
                        <span>Join Our Team</span>
                    </a>
                </div>

                <div class="nav-item">
                    <a href="products.html?category=Electronics" class="nav-link">
                        Electronics & Gadgets
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </a>
                    <div class="dropdown-menu">
                        <a href="products.html?search=audio%20wearables">Audio & Wearables</a>
                        <a href="products.html?search=cameras%20gaming">Cameras & Gaming</a>
                        <a href="products.html?search=computers%20laptops">Computers & Laptops</a>
                        <a href="products.html?search=mobile%20accessories">Mobiles & Accessories</a>
                        <a href="products.html?search=smart%20home">Smart Home</a>
                    </div>
                </div>

                <div class="nav-item">
                    <a href="products.html?category=Home" class="nav-link">
                        Home, Kitchen & Living
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </a>
                    <div class="dropdown-menu">
                        <a href="products.html?search=kitchen%20appliances">Kitchen Appliances</a>
                        <a href="products.html?search=home%20decor">Home Decor</a>
                        <a href="products.html?search=bedding%20bath">Bedding & Bath</a>
                        <a href="products.html?search=furniture">Furniture</a>
                    </div>
                </div>

                <div class="nav-item">
                    <a href="products.html?category=Fashion" class="nav-link">
                        Fashion & Lifestyle
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </a>
                    <div class="dropdown-menu">
                        <a href="products.html?search=mens%20fashion">Men's Fashion</a>
                        <a href="products.html?search=womens%20fashion">Women's Fashion</a>
                        <a href="products.html?search=fashion%20accessories">Accessories</a>
                    </div>
                </div>

                <div class="nav-item">
                    <a href="products.html?category=Beauty" class="nav-link">
                        Beauty & Personal Care
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </a>
                    <div class="dropdown-menu">
                        <a href="products.html?search=skincare">Skincare</a>
                        <a href="products.html?search=haircare">Haircare</a>
                        <a href="products.html?search=makeup">Makeup</a>
                        <a href="products.html?search=fragrances">Fragrances</a>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="products.html?category=Health" class="nav-link">
                        Health & Wellness
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </a>
                    <div class="dropdown-menu">
                        <a href="products.html?search=vitamins">Vitamins & Supplements</a>
                        <a href="products.html?search=medical%20supplies">Medical Supplies</a>
                        <a href="products.html?search=fitness%20equipment">Fitness Equipment</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Product Detail -->
    <section class="product-detail">
        <div class="product-detail-container">
            <!-- Quick Nav -->
            <nav
                style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <a href="products.html?category=Electronics"
                    style="text-decoration: none; color: #4B5563; font-weight: 500;">Electronics</a>
                <a href="products.html?category=Home"
                    style="text-decoration: none; color: #4B5563; font-weight: 500;">Home & Kitchen</a>
                <a href="products.html?category=Fashion"
                    style="text-decoration: none; color: #4B5563; font-weight: 500;">Fashion</a>
                <a href="products.html?category=Beauty"
                    style="text-decoration: none; color: #4B5563; font-weight: 500;">Beauty</a>
                <a href="products.html?category=Health"
                    style="text-decoration: none; color: #4B5563; font-weight: 500;">Health</a>
                <a href="products.html" style="text-decoration: none; color: #8B5CF6; font-weight: 600;">All
                    Products</a>
            </nav>

            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="index.html">Home</a>
                <span>â€º</span>
                <a href="products.html">Products</a>
                <span>â€º</span>
                <span id="breadcrumbCategory">Category</span>
            </nav>

            <div class="product-detail-grid">
                <div class="product-gallery">
                    <img id="productImage" src="" alt="Product Image">
                </div>

                <!-- Product Info -->
                <div class="product-detail-info">
                    <span class="product-category" id="productCategory"></span>
                    <h1 id="productTitle">Loading product...</h1>
                    <p class="product-detail-price" id="productPrice"></p>
                    <p class="product-detail-description">This premium quality product has been carefully selected based
                        on customer reviews, quality ratings, and value for money. Click the button below to view the
                        full product details and current pricing on Amazon.</p>

                    <a href="#" class="amazon-btn" id="amazonLink" target="_blank" rel="noopener noreferrer">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                        Check Price on Amazon
                    </a>

                    <!-- Affiliate Disclosure -->
                    <div class="product-disclosure">
                        <strong>Affiliate Disclosure:</strong> We participate in affiliate marketing programs and may
                        earn a commission from qualifying purchases at no additional cost to you. Product availability
                        is subject to change.
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            <section class="products-section" style="padding: 40px 0;">
                <div class="section-header">
                    <h2 class="section-title">Related Products</h2>
                </div>
                <div class="products-grid" id="relatedProducts"></div>
            </section>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-brand">
                    <img src="assets/logo.png" alt="Wasam.Pick">
                    <p>Your trusted source for quality products.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="products.html">All Products</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms.html">Terms & Conditions</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-disclosure">
                <p><strong>Affiliate Disclosure:</strong> We participate in affiliate marketing programs and may earn a
                    commission from qualifying purchases at no additional cost to you. Product availability is subject
                    to change.</p>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 wasam.store. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/products.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get product ID from URL
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            function fetchRelatedProducts(product) {
                const query = product.title.split(' ').slice(0, 3).join(' '); // Use first 3 words
                fetch(`/api/search?query=${encodeURIComponent(query)}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.data && data.data.products && data.data.products.length > 0) {
                            const related = data.data.products
                                .filter(p => p.asin !== product.id) // Exclude current
                                .slice(0, 4)
                                .map(item => ({
                                    id: item.asin,
                                    title: item.product_title,
                                    price: parseFloat(item.product_price ? item.product_price.replace('$', '').replace(',', '') : 0),
                                    category: 'Related',
                                    image: item.product_photo,
                                    badge: item.product_badge
                                }));

                            if (related.length > 0) {
                                document.getElementById('relatedProducts').innerHTML = related.map(p => createProductCard(p)).join('');
                            } else {
                                document.getElementById('relatedProducts').innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">No related products found.</p>';
                            }
                        }
                    })
                    .catch(err => console.error('Related fetch error:', err));
            }

            function renderFetchedProduct(product) {
                // Update page content
                document.title = `${product.title} | Wasam.store`;
                document.getElementById('productTitle').textContent = product.title;
                document.getElementById('productPrice').textContent = product.price ? `$${parseFloat(String(product.price).replace('$', '')).toFixed(2)}` : 'Check Price';
                document.getElementById('productCategory').textContent = product.subcategory || product.category || 'Details';
                document.getElementById('productImage').src = product.image;
                document.getElementById('productImage').alt = product.title;
                document.getElementById('breadcrumbCategory').textContent = product.category || 'Product';

                const descEl = document.querySelector('.product-detail-description');
                descEl.innerHTML = product.description || 'No description available.';

                const amazonLink = document.getElementById('amazonLink');
                // If we have a direct amazon_url use it, else fallback to search/dp link
                if (product.amazon_url) {
                    amazonLink.href = product.amazon_url;
                } else {
                    amazonLink.href = `https://www.amazon.com/dp/${product.id}`; // id is ASIN
                }
                amazonLink.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                    Check Price on Amazon`;
                amazonLink.style.display = 'inline-flex';

                // Fetch related items dynamically
                fetchRelatedProducts(product);
            }

            function fetchAndRender() {
                const descEl = document.querySelector('.product-detail-description');
                descEl.textContent = 'Fetching product details...';

                fetch(`/api/product?asin=${productId}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.data && data.data.product_title) {
                            const p = data.data;
                            const productObj = {
                                id: productId,
                                title: p.product_title,
                                price: p.product_price, // comes as string usually
                                image: p.product_photo,
                                description: p.product_description || (p.about_product ? `<ul>${p.about_product.map(x => `<li>${x}</li>`).join('')}</ul>` : ''),
                                category: 'General',
                                subcategory: 'Deal'
                            };
                            renderFetchedProduct(productObj);
                        } else {
                            document.getElementById('productTitle').textContent = 'Product not found';
                            descEl.textContent = 'Could not retrieve product details at this time.';
                            document.querySelector('.amazon-btn').style.display = 'none';
                        }
                    })
                    .catch(e => {
                        console.error(e);
                        document.getElementById('productTitle').textContent = 'Error loading product';
                    });
            }

            function renderProductDetails() {
                const product = getProductById(productId);

                if (product) {
                    // Update page content from cache (Search results)
                    document.title = `${product.title} | Wasam.store`;
                    document.getElementById('productTitle').textContent = product.title;
                    document.getElementById('productPrice').textContent = `$${product.price.toFixed(2)}`;
                    document.getElementById('productCategory').textContent = product.subcategory || product.category;
                    document.getElementById('productImage').src = product.image;
                    document.getElementById('productImage').alt = product.title;
                    document.getElementById('breadcrumbCategory').textContent = product.category;

                    // Update description (Might be empty in search result, so fetch it)
                    const descEl = document.querySelector('.product-detail-description');
                    if (product.description) {
                        descEl.innerHTML = product.description;
                    } else {
                        descEl.textContent = 'Loading full details...';
                        fetch(`/api/product?asin=${product.id}`)
                            .then(res => res.json())
                            .then(data => {
                                if (data.data) {
                                    const fullDesc = data.data.product_description ||
                                        (data.data.about_product ? `<ul>${data.data.about_product.map(p => `<li>${p}</li>`).join('')}</ul>` : '');
                                    if (fullDesc) {
                                        product.description = fullDesc;
                                        descEl.innerHTML = fullDesc;
                                    } else {
                                        descEl.textContent = 'See Amazon for full details.';
                                    }
                                }
                            })
                            .catch(err => descEl.textContent = 'Details unavailable');
                    }

                    // Button logic
                    const amazonLink = document.getElementById('amazonLink');
                    amazonLink.href = product.amazon_url || `https://www.amazon.com/dp/${product.id}`;

                    // Related
                    const related = getRelatedProducts(product, 4);
                    document.getElementById('relatedProducts').innerHTML = related.map(p => createProductCard(p)).join('');

                } else {
                    // Product NOT in cache (Direct link or refresh) -> Fetch it physically
                    fetchAndRender();
                }
            }

            // Check if products are already loaded (array populated from products.js)
            if (typeof allProducts !== 'undefined' && allProducts.length > 0) {
                renderProductDetails();
            } else {
                // Wait for the custom event from products.js
                // NOTE: products.js might finish loading "bestselling" but our ID is NOT in it.
                // So we listen, and then checking cache. If still not found, fetchAndRender handles it.
                window.addEventListener('productsLoaded', renderProductDetails);
            }
        });
    </script>
</body>

</html>